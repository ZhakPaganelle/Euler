##Distance of random points within hollow square laminae

Assuming that two points are chosen randomly (with uniform distribution) within a rectangle, it is possible to determine the expected value of the distance between these two points.
For example, the expected distance between two random points in a unit square is about 0.521405, while the expected distance between two random points in a rectangle with side lengths 2 and 3 is about 1.317067.
Now we define a hollow square lamina of size n to be an integer sized square with side length n ≥ 3 consisting of n2 unit squares from which a rectangle consisting of x × y unit squares (1 ≤ x,y ≤ n - 2) within the original square has been removed.
For n = 3 there exists only one hollow square lamina:

For n = 4 you can find 9 distinct hollow square laminae, allowing shapes to reappear in rotated or mirrored form:

Let S(n) be the sum of the expected distance between two points chosen randomly within each of the possible hollow square laminae of size n. The two points have to lie within the area left after removing the inner rectangle, i.e. the gray-colored areas in the illustrations above.
For example, S(3) = 1.6514 and S(4) = 19.6564, rounded to four digits after the decimal point.
Find S(40) rounded to four digits after the decimal point.
##Расстояния между случайными точками внутри полых квадратных пластинок

Предположив, что две точки выбраны случайным образом (с равномерным распределением) внутри прямоугольника, возможно определить ожидаемое значение расстояния между этими двумя точками.
Например, ожидаемое расстояние между двумя случайными точками в единичном квадрате примерно равно 0.521405, в то время как ожидаемое расстояние между двумя случайными точками в прямоугольнике с длинами сторон 2 и 3 примерно равно 1.317067.
Теперь определим полую квадратную пластинку размером n как квадрат с целочисленной длиной стороны, равной n ≥ 3, состоящий из n2 единичных квадратов, из которого удален прямоугольник, состоящий из x × y единичных квадратов (1 ≤ x,y ≤ n - 2) и лежащий внутри изначального квадрата.
Для n = 3 существует всего одна полая квадратная пластинка:

Для n = 4 можно найти 9 различных полых квадратных пластинок, среди которых некоторые являются зеркальным отражением других:

Пусть S(n) будет суммой ожидаемых расстояний между двумя случайными точками в каждой возможной полой квадратноq пластинке размера n. Эти две точки должны лежать на площади, оставшейся после удаления внутреннего прямоугольника, т.е. в закрашенных серым областях на рисунках выше.
Например, S(3) = 1.6514 и S(4) = 19.6564, округленные до четвертого знака после десятичной точки.
Найдите значение S(40), округленное до четвертого знака после десятичной точки.
