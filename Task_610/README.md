##Roman Numerals II

A random generator produces a sequence of symbols drawn from the set {I, V, X, L, C, D, M, #}. Each item in the sequence is determined by selecting one of these symbols at random, independently of the other items in the sequence. At each step, the seven letters are equally likely to be selected, with probability 14% each, but the # symbol only has a 2% chance of selection.
We write down the sequence of letters from left to right as they are generated, and we stop at the first occurrence of the # symbol (without writing it). However, we stipulate that what we have written down must always (when non-empty) be a valid Roman numeral representation in minimal form. If appending the next letter would contravene this then we simply skip it and try again with the next symbol generated.
Please take careful note of About... Roman Numerals for the definitive rules for this problem on what constitutes a "valid Roman numeral representation" and "minimal form". For example, the (only) sequence that represents 49 is XLIX. The subtractive combination IL is invalid because of rule (ii), while XXXXIX is valid but not minimal. The rules do not place any restriction on the number of occurrences of M, so all positive integers have a valid representation. These are the same rules as were used in Problem 89, and members are invited to solve that problem first.
Find the expected value of the number represented by what we have written down when we stop. (If nothing is written down then count that as zero.) Give your answer rounded to 8 places after the decimal point.
##Римские цифры II

Случайный генератор выдает последовательность символов, выбранных из множества {I, V, X, L, C, D, M, #}. Каждый элемент последовательности определяется путем случайного выбора одного из этих символов независимо от других элементов последовательности. В каждом шаге все семь букв имеют одинаковую вероятность быть выбранными, равную 14%, но символ # имеет вероятность выбора всего лишь 2%.
Мы записываем последовательность букв слева направо в том порядке, в каком они сгенерированы, и останавливаемся при первом появлении символа # (его сам при этом не записывая). Однако, мы оговариваем, что записанное нами должно всегда (когда непустое) являться корректной записью числа римскими цифрами в минимальной форме. Если добавление следующей буквы противоречит этому, мы ее пропускаем и пробуем снова со следующим сгенерированным символом.
Пожалуйста, внимательно прочитайте "О римских цифрах", чтобы узнать конкретные правила, определяющие "корректную запись числа римскими цифрами" и "минимальную форму". Например, последовательность (единственная), представляющая число 49 - это XLIX. Субтрактивная комбинация IL некорректна из-за правила (ii), а комбинация XXXXIX - корректна, но не минимальна. Правила никак не ограничивают количество появлений символа M, поэтому все целые числа имеют корректное представление. Эти правила также использовались в Задаче 89, и мы предлагаем вам сначала решить ее.
Найдите ожидаемое значение числа, представленного тем, что мы записали до остановки (если ничего не было записано, то считайте это число за ноль). Дайте ваш ответ округленным до 8 знака после десятичной точки.
